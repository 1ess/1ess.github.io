<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title> · A Sort Of A Blog</title><meta name="description" content="本篇，我们在来说一下在 Linux 下，有关正则和文本处理的相关知识。
正则表达式
之前我们讲过正则，我们来回顾下。
基本语法一个正则表达式通常被称为一个模式(pattern)，为用来描述或者匹配一系列符合某个句法规则的字符串。
选择| 竖直分隔符表示选择，例如 boy|girl 可以匹配 boy "><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="https://cdn.jsdelivr.net/gh/1ess/cdn/h4cker/favicon-32x32.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">0x7c00</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">张冬冬的博客</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首頁</a></li><li><a href="/archives">歸檔</a></li><li class="soc"><a href="https://github.com/1ess" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2021&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a></a></p><p class="post-meta"><span class="date meta-item">發佈於&nbsp;2021-07-14</span></p><p class="post-abstract"><p>本篇，我们在来说一下在 Linux 下，有关正则和文本处理的相关知识。</p>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><hr>
<p>之前我们讲过正则，我们来回顾下。</p>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>一个正则表达式通常被称为一个模式(pattern)，为用来描述或者匹配一系列符合某个句法规则的字符串。</p>
<h4 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h4><p>| 竖直分隔符表示选择，例如 boy|girl 可以匹配 boy 或者 girl。</p>
<h4 id="数量限定"><a href="#数量限定" class="headerlink" title="数量限定"></a>数量限定</h4><p>数量限定符号有 </p>
<ul>
<li>*: 出现 0 次或多次</li>
<li>+: 出现 1 次或多次</li>
<li>?: 出现 0 次或 1 次</li>
</ul>
<p>如果在一个模式中不加数量限定符则表示出现一次且仅出现一次。</p>
<p>如果要表示其他次数可以使用: </p>
<ul>
<li>{m}: 出现 m 次</li>
<li>{m,}: 至少出现 m 次</li>
<li>{m,n}: 出现 m 到 n 次</li>
<li>{,n}: 出现 0 到 n 次</li>
</ul>
<h4 id="范围和优先级"><a href="#范围和优先级" class="headerlink" title="范围和优先级"></a>范围和优先级</h4><p>() 圆括号可以用来定义模式字符串的范围和优先级，这可以简单的理解为是否将括号内的模式串作为一个整体。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><table>
<thead>
<tr>
<th>字符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>匹配除换行符之外的任意字符</td>
</tr>
<tr>
<td>\w</td>
<td>匹配字母，数字，下划线或汉字</td>
</tr>
<tr>
<td>\s</td>
<td>匹配任意空白字符</td>
</tr>
<tr>
<td>\d</td>
<td>匹配数字</td>
</tr>
<tr>
<td>\</td>
<td>将下一个字符标记为一个特殊字符、或一个原义字符</td>
</tr>
<tr>
<td>^</td>
<td>匹配输入字符串的开始位置</td>
</tr>
<tr>
<td>$</td>
<td>匹配输入字符串的结束位置</td>
</tr>
<tr>
<td>?</td>
<td>当该字符紧跟在任何一个其他限制符(*,+,?,{n},{n,},{n,m})后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串</td>
</tr>
<tr>
<td>[xyz]</td>
<td>字符集合(character class)，匹配所包含的任意一个字符</td>
</tr>
<tr>
<td>[^xyz]</td>
<td>排除型(negate)字符集合，匹配未列出的任意字符</td>
</tr>
</tbody></table>
<h4 id="基本正则-BRE-和-扩展正则-ERE"><a href="#基本正则-BRE-和-扩展正则-ERE" class="headerlink" title="基本正则(BRE) 和 扩展正则(ERE)"></a>基本正则(BRE) 和 扩展正则(ERE)</h4><p>基本正则只支持 * 数量限定，如果不使用扩展正则，想使用其他数量限定，则必须使用 \ 来转义。基本正则不支持 \w，\d 等，需要使用 [a-zA-Z0-9_-] 和 [0-9] 代替。</p>
<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><hr>
<p>sed(stream editor)，流编辑器，用程序的方式来编辑文本。一次处理一行，行是 sed 处理的基本单位。</p>
<h3 id="模式空间和缓冲空间"><a href="#模式空间和缓冲空间" class="headerlink" title="模式空间和缓冲空间"></a>模式空间和缓冲空间</h3><ul>
<li>模式空间: 处理文件中一行内容的临时缓冲区，处理完这一行会将这一行输出标准输出并清空缓冲区</li>
<li>缓存空间: 另一个缓冲区，不会自动清空也不会主动打印，是 sed 的辅助空间</li>
</ul>
<h3 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h3><p>格式为: </p>
<pre class="line-numbers language-sh"><code class="language-sh">sed [options] &#123;sed-commands&#125; &#123;input-file&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>例如: </p>
<pre class="line-numbers language-sh"><code class="language-sh"># source.txt
101,Ian Bicking,Mozilla
102,Hakim El Hattab,Whim
103,Paul Irish,Google
104,Addy Osmani,Google
105,Chris Wanstrath,Github
106,Mattt Thompson,Heroku
107,Ask Solem Hoel,VMware

# -n 表示取消默认输出，p 表示打印行
$sed -n 'p' source.txt

# 只打印第三行
$sed -n '3p' source.txt
# 103,Paul Irish,Google

# 打印 1 到 3 行
$sed -n '1,3p' source.txt
# 101,Ian Bicking,Mozilla
# 102,Hakim El Hattab,Whim
# 103,Paul Irish,Google

# 寻找包含 Paul 的行
$sed -n '/Paul/p' source.txt
# 103,Paul Irish,Google

# 从第一行开始到第五行, 从找到开始打印到第五行
$sed -n '/Paul/,5p' source.txt
# 103,Paul Irish,Google
# 104,Addy Osmani,Google
# 105,Chris Wanstrath,Github

# 从匹配 Paul 行打印达匹配 Addy 的行
$sed -n '/Paul/,/Addy/p' source.txt
# 103,Paul Irish,Google
# 104,Addy Osmani,Google
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意: </p>
<ul>
<li>-n 选项会抑制默认的打印</li>
<li>其中的地址范围可以是行号或者正则</li>
<li>默认的模式匹配不支持扩展正则，只支持基本正则。如果想支持扩展正则，需要使用 -r 选项</li>
<li>$ 代表最后一行行号</li>
</ul>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p>格式与查找相同: </p>
<pre class="line-numbers language-sh"><code class="language-sh">sed [options] &#123;sed-commands&#125; &#123;input-file&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>例如:</p>
<pre class="line-numbers language-sh"><code class="language-sh"># 删除所有行
$sed 'd' source.txt 

# 只删除第二行
$sed '2d' source.txt

# 删除第一到第四行
$sed '1,4d' source.txt

# 删除空行
$sed '/^$/d' source.txt

# 删除评论行
$sed '/^#/d' source.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意: </p>
<ul>
<li>删除并不会影响源文件，如果也想修改源文件，可以使用 -i 参数或重定向</li>
<li>Mac 下需要使用 -i “” 来影响源文件</li>
</ul>
<h3 id="替换-substitute"><a href="#替换-substitute" class="headerlink" title="替换(substitute)"></a>替换(substitute)</h3><p>替换格式为: </p>
<pre class="line-numbers language-sh"><code class="language-sh">sed '[address-range|pattern-range]s/original-string/replacement-string/[substitute-flags]' inputfile
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>例如: </p>
<pre class="line-numbers language-sh"><code class="language-sh"># 替换 Google 为 Github
$sed 's/Google/Github/' source.txt
# 101,Ian Bicking,Mozilla
# 102,Hakim El Hattab,Whim
# 103,Paul Irish,Github
# 104,Addy Osmani,Github
# 105,Chris Wanstrath,Github
# 106,Mattt Thompson,Heroku
# 107,Ask Solem Hoel,VMware

# 替换匹配 Addy 的行里面的 Google 为 Github
$sed '/Addy/s/Google/Github/' source.txt
# 101,Ian Bicking,Mozilla
# 102,Hakim El Hattab,Whim
# 103,Paul Irish,Google
# 104,Addy Osmani,Github
# 105,Chris Wanstrath,Github
# 106,Mattt Thompson,Heroku
# 107,Ask Solem Hoel,VMware

# 替换第一行中的首个匹配项
$sed '1s/a/A/' source.txt|head -1
# 101,IAn Bicking,Mozilla

# g 可以替换每行的全部符合
$sed 's/a/A/g' source.txt|head -1
# 101,IAn Bicking,MozillA

# 可以直接指定想要替换的第 N 个匹配项,这里是第一行第二个
$sed '1s/a/A/2' source.txt|head -1
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="提取"><a href="#提取" class="headerlink" title="提取"></a>提取</h3><p>括号括起来的正则表达式所匹配的字符串会可以当成变量来使用，sed 中使用的是 \1，\2。</p>
<pre class="line-numbers language-sh"><code class="language-sh">sed -rn '/bash$/s/(\w+):.*/\1/p' passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注意: -r 选项可以使用扩展正则表达式，如果不使用扩展，则应写成如下形式: </p>
<pre class="line-numbers language-sh"><code class="language-sh">sed -rn '/bash$/s/\([a-zA-Z0-9_-]\+\):.*/\1/p' passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><p>在第 5 行之上插入，使用 i: </p>
<pre class="line-numbers language-sh"><code class="language-sh">sed -i '5 i hello world' source.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="追加"><a href="#追加" class="headerlink" title="追加"></a>追加</h3><p>在第 10 行之下追加，使用 a: </p>
<pre class="line-numbers language-sh"><code class="language-sh">sed -i '10 a hello world' source.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="更改"><a href="#更改" class="headerlink" title="更改"></a>更改</h3><p>更改第 5 行的内容，使用 c: </p>
<pre class="line-numbers language-sh"><code class="language-sh">sed -i '5 c hello world' source.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><hr>
<p>awk 是贝尔实验室 1977 年开发的用于处理文本文件的一个应用程序，它依次处理文件的每一行，并读取里面的每一个字段。对于日志等每行格式相同的文本文件，awk 可能是最方便的工具。<br>之所以叫 awk 是因为其取了三位创始人 Alfred Aho，Peter Weinberger 和 Brian Kernighan 名字的首字母。<br>awk 其实不仅仅是工具软件，还是一种编程语言，接下来我们分几个方面介绍一下基本使用。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>awk 的基本格式: </p>
<pre class="line-numbers language-sh"><code class="language-sh">awk -Fs '/pattern/ &#123;action&#125;' input-file
#or
awk -Fs '&#123;action&#125;' intput-file
# -F 表示设置分隔符,不指定就是默认为空字符

# 示例
awk '&#123;print $0&#125;' god.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>awk 默认会根据 -F 表示设置分隔符(空格和制表符)，将每一行分成若干字段，依次用 $1、$2、$3 代表第一个字段、第二个字段、第三个字段等，而 $0 表示的是当前行。</p>
<pre class="line-numbers language-sh"><code class="language-sh">echo 'This is a demo for awk.' | awk '&#123;print $3&#125;'
# a
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>我们还可以使用 -F 参数来指定分割符: </p>
<pre class="line-numbers language-sh"><code class="language-sh">awk -F ':' '&#123;print $1&#125;' /etc/passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>除了 $ + 数字 表示某个字段，awk 还提供其他一些变量。</p>
<h4 id="NF"><a href="#NF" class="headerlink" title="NF"></a>NF</h4><p>变量 NF 表示当前行有多少个字段，因此 $NF 就代表最后一个字段，$(NF-1) 代表倒数第二个字段。</p>
<pre class="line-numbers language-sh"><code class="language-sh">awk -F ':' '&#123;print $1, $NF&#125;' /etc/passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>命令里面可以使用逗号，表示输出的时候，两个部分之间使用空格分隔。</p>
<h4 id="NR"><a href="#NR" class="headerlink" title="NR"></a>NR</h4><p>变量 NR 表示当前处理的是第几行: </p>
<pre class="line-numbers language-sh"><code class="language-sh">awk -F ':' '&#123;print NR "." $1 $NF&#125;' /etc/passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>awk 还提供了一些内置函数，方便对原始数据的处理，常见函数有: </p>
<ul>
<li>toupper()</li>
<li>tolower()</li>
<li>length()</li>
<li>substr()</li>
<li>sqrt()</li>
<li>rand()</li>
<li>match()</li>
<li>index()</li>
</ul>
<h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><p>awk 允许指定输出条件，只输出符合条件的行，格式为: </p>
<pre class="line-numbers language-sh"><code class="language-sh">awk '条件 动作' [文件名]

# 示例
awk -F ':' '$1 == "root" &#123;print $0&#125;' /etc/passwd

awk -F ':' 'NR % 2 == 1 &#123;print $1&#125;' /etc/passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意: 条件可以是正则表达式，格式为 /正则/。awk 允许运算符 ~，用来测试正则表达式是否可以与某一字符串匹配。</p>
<h3 id="if-语句"><a href="#if-语句" class="headerlink" title="if 语句"></a>if 语句</h3><p>awk 提供了 if 结构，用于编写复杂的条件: </p>
<pre class="line-numbers language-sh"><code class="language-sh">awk -F ':' '&#123;if ($1 > "m") print $1&#125;' /etc/passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>if 结构还可以指定 else 部分: </p>
<pre class="line-numbers language-sh"><code class="language-sh">awk -F ':' '&#123;if ($1 > "m") print $1; else print "---"&#125;' /etc/passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><hr>
<p>grep(globally search a regular expression and print) 会对匹配一个或多个正则表达式的文本进行搜索，并只输出匹配(或者不匹配)的行。</p>
<h3 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h3><ul>
<li>i: 忽略大小写</li>
<li>n: 输出行号</li>
<li>v: 反向选择</li>
</ul>
</p></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/Linux(%E5%85%AD)/" title=""><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: </a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/Nginx(%E4%B8%80)/" title="">下一篇: &nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2021&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>