<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title> · A Sort Of A Blog</title><meta name="description" content="本篇，我们说说 MySQL 中的联合查询、连接查询以及子查询。
联合查询
基本概念: 可合并多个相似的选择查询结果的结果集，等同于将一个表追加到另一个表，从而实现将两个表的查询结果组合到一起，使用 Union 或 Union all。注意: 这个合并是纵向合并，字段数不变，多个查询的结果合并。
应用"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="https://cdn.jsdelivr.net/gh/1ess/cdn/h4cker/favicon-32x32.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">0x7c00</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">张冬冬的博客</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首頁</a></li><li><a href="/archives">歸檔</a></li><li class="soc"><a href="https://github.com/1ess" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2021&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a></a></p><p class="post-meta"><span class="date meta-item">發佈於&nbsp;2021-07-14</span></p><p class="post-abstract"><p>本篇，我们说说 MySQL 中的联合查询、连接查询以及子查询。</p>
<h2 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h2><hr>
<p>基本概念: 可合并多个相似的选择查询结果的结果集，等同于将一个表追加到另一个表，从而实现将两个表的查询结果组合到一起，使用 Union 或 Union all。<br>注意: 这个合并是纵向合并，字段数不变，多个查询的结果合并。</p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ol>
<li>同一张表的不同结果，合并到一起展示</li>
<li>在大数据量情况，会分表操作，会使用联合查询将数据存放到一起显示</li>
</ol>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>select 语句 union [all/distinct(默认)] select 语句;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql">(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;男&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> height <span class="hljs-keyword">asc</span>)<br><span class="hljs-keyword">union</span> <br>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> height <span class="hljs-keyword"><code class="language-hljs sql">(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;男&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> height <span class="hljs-keyword">asc</span>)<br><span class="hljs-keyword">union</span> <br>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> height <span class="hljs-keyword">desc</span>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<p>注意: 如果联合查询中使用 order by，必须把该 select 语句使用括号包裹。并且 MySQL 8.0 之前，为了使 order by 生效，还必须使用 limit {大数量}</p>
<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><hr>
<p>基本概念: 将多张表连接到一起进行查询，会导致记录的行数和字段列数发生改变。</p>
<p>连接查询分类: </p>
<ol>
<li>交叉连接</li>
<li>内连接</li>
<li>外连接</li>
</ol>
<ul>
<li>左连接</li>
<li>右连接</li>
</ul>
<ol start="4">
<li>自然连接</li>
</ol>
<h3 id="交叉连接-Cross-Join"><a href="#交叉连接-Cross-Join" class="headerlink" title="交叉连接(Cross Join)"></a>交叉连接(Cross Join)</h3><p>之前咱们说过多表查询时，就说过交叉查询的概念，只是语法不同。<br>基本语法: {表1} cross join {表2};</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">cross</span> <span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">cross</span> <span class="hljs-keyword">join</span> my_operator;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<h3 id="内连接-Inner-Join"><a href="#内连接-Inner-Join" class="headerlink" title="内连接(Inner Join)"></a>内连接(Inner Join)</h3><p>从一张表中取出所有的记录，去另一张表中匹配，利用匹配条件进行匹配，成功保留，失败舍去。<br>基本语法: {表1} [inner] join {表2} on {匹配条件};<br>注意: 如果内连接没有条件，则与交叉连接返回结果一样。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> my_class <span class="hljs-keyword">on</span> my_stud.class_id <span class="hljs-operator"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> my_class <span class="hljs-keyword">on</span> my_stud.class_id <span class="hljs-operator">=</span> my_class.id;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<p>由于表名可能很长，我们通常也使用表别名简化操作。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">as</span> a <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> my_class <span class="hljs-keyword">as</span> b <span class="hljs-keyword">on</span> a.class_id <span class="hljs-operator"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">as</span> a <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> my_class <span class="hljs-keyword">as</span> b <span class="hljs-keyword">on</span> a.class_id <span class="hljs-operator">=</span> b.id;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<p>注意: 内连接只有匹配到的记录才会保留。</p>
<h3 id="外连接-Outer-Join"><a href="#外连接-Outer-Join" class="headerlink" title="外连接(Outer Join)"></a>外连接(Outer Join)</h3><p>一张表作为主表(表中记录都会保留)，根据条件去匹配另一张从表中的记录，从而得到目标数据。<br>外连接分为: </p>
<ul>
<li>左外连接(left join)，左表作为主表</li>
<li>右外连接(right join)，右表作为主表</li>
</ul>
<p>左连接基本语法: {主表} left join {从表} on {匹配条件};<br>右连接基本语法: {从表} right join {主表} on {匹配条件};</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">as</span> s <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> my_class <span class="hljs-keyword">as</span> c <span class="hljs-keyword">on</span> s.class_id <span class="hljs-operator"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">as</span> s <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> my_class <span class="hljs-keyword">as</span> c <span class="hljs-keyword">on</span> s.class_id <span class="hljs-operator">=</span> c.id; <br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<p>注意: 如果从表数据都不匹配，则返回结果该条记录从表字段值都为 null。</p>
<h3 id="Using-关键字"><a href="#Using-关键字" class="headerlink" title="Using 关键字"></a>Using 关键字</h3><p>是在连接查询中替代 on 关键字的。<br>使用前提是两张表连接的字段是同名的，并且最终在结果只保留一个字段。</p>
<p>基本语法: {表1} [inner/left/right join] {表2} using({同名字段列表});</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> my_class <span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> my_class <span class="hljs-keyword">using</span>(class_id);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><hr>
<p>当一个查询是另一个查询的条件时，称之为子查询(Sub Query)。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>按功能来分: </p>
<ul>
<li>标量子查询: 子查询返回结果是一个数据</li>
<li>列子查询: 返回结果是一列</li>
<li>行子查询: 返回结果时一行</li>
<li>表子查询: 返回结果是多行多列</li>
<li>Exists 子查询: 返回结果是 1 或 0</li>
</ul>
<p>按位置来分: </p>
<ul>
<li>Where 子查询: 子查询语句出现在 Where 子句中</li>
<li>From 子查询: 子查询语句出现在 From 子句中，作为数据源</li>
</ul>
<h3 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h3><p>标量子查询 where 子句常使用 = 或 &lt;&gt; 操作符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_class <span class="hljs-keyword">as</span> c <span class="hljs-keyword">where</span> c.id <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> class_id <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">as</span> s <span class="hljs-keyword">where</span> s.name <span class="hljs-operator">=</span> <span class="hljs-string"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_class <span class="hljs-keyword">as</span> c <span class="hljs-keyword">where</span> c.id <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> class_id <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">as</span> s <span class="hljs-keyword">where</span> s.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;zhangsan&#x27;</span>);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<h3 id="列子查询"><a href="#列子查询" class="headerlink" title="列子查询"></a>列子查询</h3><p>列子查询 where 子句常使用 in 操作符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_class <span class="hljs-keyword">as</span> c <span class="hljs-keyword">where</span> c.id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> class_id <span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_class <span class="hljs-keyword">as</span> c <span class="hljs-keyword">where</span> c.id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> class_id <span class="hljs-keyword">from</span> my_stud);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<h3 id="行子查询"><a href="#行子查询" class="headerlink" title="行子查询"></a>行子查询</h3><p>行子查询 where 子句 = 左值要是一个构造的行元素。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_class <span class="hljs-keyword">where</span> (age, height) <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age), <span class="hljs-built_in">max</span>(height) <span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_class <span class="hljs-keyword">where</span> (age, height) <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age), <span class="hljs-built_in">max</span>(height) <span class="hljs-keyword">from</span> my_stud);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<h3 id="表子查询"><a href="#表子查询" class="headerlink" title="表子查询"></a>表子查询</h3><p>表子查询用于 from 数据源，之前在动态查询时已经说过。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> height <span class="hljs-keyword">desc</span>) <span class="hljs-keyword">as</span> order_stud <span class="hljs-keyword">group</span> <span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> height <span class="hljs-keyword">desc</span>) <span class="hljs-keyword">as</span> order_stud <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> class_id;<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure>

<h3 id="Exists-子查询"><a href="#Exists-子查询" class="headerlink" title="Exists 子查询"></a>Exists 子查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class="line-numbers language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_class <span class="hljs-keyword">as</span> c <span class="hljs-keyword">where</span> <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">as</span> s <span class="hljs-keyword">where</span> s.class_id <span class="hljs-operator"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_class <span class="hljs-keyword">as</span> c <span class="hljs-keyword">where</span> <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> my_stud <span class="hljs-keyword">as</span> s <span class="hljs-keyword">where</span> s.class_id <span class="hljs-operator">=</span> c.id);<br><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></td></tr></table></figure></p></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/MySQL(%E5%9B%9B)/" title=""><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: </a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/MySQL(%E5%85%AD)/" title="">下一篇: &nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2021&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>