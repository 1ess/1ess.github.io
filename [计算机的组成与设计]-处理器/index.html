<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>『计算机的组成与设计』-处理器 · A Sort Of A Blog</title><meta name="description" content="程序必须首先让人类可以理解，然后顺便让机器能执行。

前面几篇我们说过，一台计算机的性能有三个关键因素决定: 指令数目，时钟周期长度和每条指令所需要的时钟周期数 CPI。编译器和指令集决定了一个程序所需的指令数目，而处理器则决定了时钟周期长度和 CPI。本篇通过一个基本 MIPS 实现，来了解实现一"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="https://cdn.jsdelivr.net/gh/1ess/cdn/h4cker/favicon-32x32.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">0x7c00</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">张冬冬的博客</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首頁</a></li><li><a href="/archives">歸檔</a></li><li class="soc"><a href="https://github.com/1ess" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2021&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>『计算机的组成与设计』-处理器</a></p><p class="post-meta"><span class="date meta-item">發佈於&nbsp;2018-05-15</span></p><p class="post-abstract"><blockquote>
<p>程序必须首先让人类可以理解，然后顺便让机器能执行。</p>
</blockquote>
<p>前面几篇我们说过，一台计算机的性能有三个关键因素决定: <strong>指令数目</strong>，<strong>时钟周期长度</strong>和<strong>每条指令所需要的时钟周期数 CPI</strong>。<br>编译器和指令集决定了一个程序所需的指令数目，而处理器则决定了时钟周期长度和 CPI。<br>本篇通过一个基本 MIPS 实现，来了解实现一个处理器所需要的原理和技术。</p>
<h2 id="基本-MIPS-实现"><a href="#基本-MIPS-实现" class="headerlink" title="基本 MIPS 实现"></a>基本 MIPS 实现</h2><hr>
<ul>
<li>访存指令: lw 和 sw</li>
<li>运算指令: add，sub，AND，OR 和 slt</li>
<li>分支指令: beq 和 j</li>
</ul>
<h3 id="实现方式概述"><a href="#实现方式概述" class="headerlink" title="实现方式概述"></a>实现方式概述</h3><p>通过之前几篇的叙述，我们知道要实现的这几个简单指令的实现过程大致相同，与具体指令无关。<br>实现每条指令的前两步是一样的: </p>
<ol>
<li>程序计数器(PC)指向指令所在的储存单元，从中取出指令。</li>
<li>通过指令，读取一个或两个寄存器。对于取字指令，只需读取一个寄存器，其他大多数指令需要读取两个寄存器。</li>
</ol>
<p>这两步之后的步骤取决于具体的指令类型，详见<strong>建立数据通路的基本原则</strong></p>
<h2 id="处理器的设计步骤"><a href="#处理器的设计步骤" class="headerlink" title="处理器的设计步骤"></a>处理器的设计步骤</h2><hr>
<ol>
<li>分析指令系统，得出对数据通路的需求</li>
<li>为数据通路选择合适的组件</li>
<li>连接组件建立数据通路</li>
<li>分析每条指令的实现，以确定控制信号</li>
<li>集成控制信号，形成完整的控制逻辑</li>
</ol>
<h2 id="指令的含义"><a href="#指令的含义" class="headerlink" title="指令的含义"></a>指令的含义</h2><hr>
<h3 id="指令位域的分解"><a href="#指令位域的分解" class="headerlink" title="指令位域的分解"></a>指令位域的分解</h3><p>对于R型指令，可以分为 6 个位域。最高的 6bit 称为操作码，接下来三个位域都是 5 个 bit，标识寄存器，接下来一个 5bit，用来标识移位。最后 6bit 是功能位域。<br>I型指令，可分解 3 个位域。最高的 6bit 称为操作码，接下来两个个位域都是 5 个 bit，标识寄存器，最后 16bit 是立即数位域。</p>
<h3 id="指令系统的需求"><a href="#指令系统的需求" class="headerlink" title="指令系统的需求"></a>指令系统的需求</h3><ul>
<li>算术逻辑单元(ALU)</li>
</ul>
<ol>
<li>算术类型: 加，减，或，比较等</li>
<li>操作数: 2 个 32 位的数，来自寄存器或扩展后的立即数</li>
</ol>
<ul>
<li>立即数扩展部件</li>
</ul>
<ol>
<li>将一个 16 位的立即数扩展为 32 位</li>
<li>扩展方式: 0 扩展，符号扩展</li>
</ol>
<ul>
<li>程序计数器(PC)</li>
</ul>
<ol>
<li>1 个 32 位寄存器</li>
<li>支持两种加法: 加 4 或加一个立即数</li>
</ol>
<ul>
<li>寄存器堆(两读一写寄存器堆，register file)</li>
</ul>
<ol>
<li>每个寄存器为 32 位宽，共 32 个</li>
<li>支持读操作: rs 或 rt</li>
<li>支持写操作: rd 或 rt</li>
</ol>
<ul>
<li>存储器(对应 CPU 内部的 cache 而不是整个计算机的 memory)</li>
</ul>
<ol>
<li>1 个只读的指令存储器，地址和数据均是 32 位</li>
<li>1 个可读写的数据存储器，地址和数据均是 32 位</li>
</ol>
<h2 id="建立数据通路的基本原则"><a href="#建立数据通路的基本原则" class="headerlink" title="建立数据通路的基本原则"></a>建立数据通路的基本原则</h2><hr>
<p>根据指令需求，连接组件，建立数据通路<br>指令需求分为: </p>
<ol>
<li>所有指令的共同需求</li>
<li>不同指令的不同需求</li>
</ol>
<h2 id="所有指令的共同需求"><a href="#所有指令的共同需求" class="headerlink" title="所有指令的共同需求"></a>所有指令的共同需求</h2><hr>
<ol>
<li>取指令</li>
</ol>
<ul>
<li>PC 的内容就是指令的地址</li>
<li>用 PC 的内容作为地址，访问指令存储器获取指令编码  </li>
</ul>
<ol start="2">
<li>更新 PC</li>
</ol>
<ul>
<li>顺序执行: PC = PC + 4</li>
<li>发生分支: PC = 分支目标地址</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/1ess/cdn/contentImg/pipelinine/IFU.png"></p>
<h2 id="不同指令的不同需求"><a href="#不同指令的不同需求" class="headerlink" title="不同指令的不同需求"></a>不同指令的不同需求</h2><hr>
<p><img src="https://cdn.jsdelivr.net/gh/1ess/cdn/contentImg/pipelinine/diff-instruction-demand.png"></p>
<h2 id="流水线-pipelining"><a href="#流水线-pipelining" class="headerlink" title="流水线(pipelining)"></a>流水线(pipelining)</h2><hr>
<p>流水线是一种实现多条指令重叠执行的技术。<br>流水线的奇妙之处在于，当处理多个任务的时候，每个任务的总处理时间并没有缩短，但所有的工作都在并行进行，因此，单位时间能够完成的工作量就大大增加了。流水线实际改善了吞吐率。如果所有的步骤所需的时间一样，那么从流水线得到的速度提高倍数等于流水线中步骤的数目。<br><img src="https://cdn.jsdelivr.net/gh/1ess/cdn/contentImg/pipelinine/Pipeline.png"></p>
</p></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/%5B%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%BB%84%E6%88%90%E4%B8%8E%E8%AE%BE%E8%AE%A1%5D-%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84/" title="『计算机的组成与设计』-存储器层次结构"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: 『计算机的组成与设计』-存储器层次结构</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/%5B%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%BB%84%E6%88%90%E4%B8%8E%E8%AE%BE%E8%AE%A1%5D-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97/" title="『计算机的组成与设计』-计算机的算数运算">下一篇: 『计算机的组成与设计』-计算机的算数运算&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2021&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>