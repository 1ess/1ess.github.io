<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>C Sharp(十一) · A Sort Of A Blog</title><meta name="description" content="这一篇，我们再来看看 C# 中的显式转换以及隐式转换。
隐式转换有些类型的转换不会丢失数据或精度: 

C# 会自动做这些转换，称为隐式转换
从位数少的源转换为位数更多的源，目标多出来的位使用 0 或 1 补充
当从小的无符号类型转换为更大的无符号类型，多出来的位以 0 进行填充，称为 0 扩展
对"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="https://cdn.jsdelivr.net/gh/1ess/cdn/h4cker/favicon-32x32.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style-dark.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">0x7c00</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">张冬冬的博客</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首頁</a></li><li><a href="/archives">歸檔</a></li><li class="soc"><a href="https://github.com/1ess" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="https://1ess.github.io/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2022&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>C Sharp(十一)</a></p><p class="post-meta"><span class="date meta-item">發佈於&nbsp;2018-11-11</span></p><p class="post-abstract"><p>这一篇，我们再来看看 C# 中的显式转换以及隐式转换。</p>
<h3 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h3><p>有些类型的转换不会丢失数据或精度: </p>
<ul>
<li>C# 会自动做这些转换，称为隐式转换</li>
<li>从位数少的源转换为位数更多的源，目标多出来的位使用 0 或 1 补充</li>
<li>当从小的无符号类型转换为更大的无符号类型，多出来的位以 0 进行填充，称为 0 扩展</li>
<li>对于有符号类型，额外的高位使用符号位进行扩展，称为符号扩展</li>
</ul>
<h3 id="显式转换"><a href="#显式转换" class="headerlink" title="显式转换"></a>显式转换</h3><p>对于源类型的任意值在被转换为目标类型时会丢失的情况，C# 语言是不提供两种类型的自动转换，如果我们希望这两种类型进行转换，就必须使用显式转换，这叫做强制转换表达式。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><code class="hljs csharp"><span class="hljs-built_in">ushort</span> var1 = <span class="hljs-number">10</span>;<br><span class="hljs-built_in">sbyte</span> var2 = (<span class="hljs-built_in">sbyte</span>)var1;<br></code></pre></td></tr></table></figure>

<h3 id="装箱转换"><a href="#装箱转换" class="headerlink" title="装箱转换"></a>装箱转换</h3><p>C# 所有类型都继承自 object 类型，然而，值类型是高效轻量的类型，但是当我们需要对象组件，可以使用装箱。<br>装箱是一种隐式转换，接受值类型的值，在堆上创建一个引用类型对象，返回该引用。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><code class="hljs csharp"><span class="hljs-built_in">int</span> i = <span class="hljs-number">12</span>;<br><span class="hljs-built_in">object</span> oi = <span class="hljs-literal">null</span>;<br>oi = i;<br></code></pre></td></tr></table></figure>

<p>需要注意的是: 装箱操作的时一个副本，装箱之后，原始值和引用副本可以独立操作。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><code class="hljs csharp"><span class="hljs-built_in">int</span> i = <span class="hljs-number">10</span>;<br><span class="hljs-built_in">object</span> oi = i;<br>Console.WriteLine(<span class="hljs-string">&quot;i: &#123;0&#125;, oi: &#123;1&#125;&quot;</span>, i, oi); <span class="hljs-comment">// 10, 10</span><br><br>i = <span class="hljs-number">12</span>;<br>oi = <span class="hljs-number">15</span>;<br>Console.WriteLine(<span class="hljs-string">&quot;i: &#123;0&#125;, oi: &#123;1&#125;&quot;</span>, i, oi); <span class="hljs-comment">// 12, 15</span><br></code></pre></td></tr></table></figure>

<h3 id="拆箱转换"><a href="#拆箱转换" class="headerlink" title="拆箱转换"></a>拆箱转换</h3><p>拆箱是将装箱后的引用返回值类型的操作。<br>注意: 拆箱是显式转换。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><code class="hljs csharp"><span class="hljs-built_in">int</span> i = <span class="hljs-number">10</span>;<br><span class="hljs-built_in">object</span> oi = i;<br><br><span class="hljs-built_in">int</span> j = (<span class="hljs-built_in">int</span>)oi;<br></code></pre></td></tr></table></figure>

<p>拆箱非值类型会抛出异常。</p>
<h3 id="is-运算符"><a href="#is-运算符" class="headerlink" title="is 运算符"></a>is 运算符</h3><p>我们可以使用 is 运算符检测转换是否会成功，避免盲目转换。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span> : <span class="hljs-title">Person</span> &#123;&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name = <span class="hljs-string">&quot;1ess&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Age = <span class="hljs-number">20</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        Employee emp = <span class="hljs-keyword">new</span> Employee();<br>        <span class="hljs-keyword">if</span> (emp <span class="hljs-keyword">is</span> Person p) &#123;<br>            <span class="hljs-comment">//如果转换失败，返回 false</span><br>            <span class="hljs-comment">//如果转换成功，返回 true，并赋值给 p</span><br>            <span class="hljs-comment">//...</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="as-运算符"><a href="#as-运算符" class="headerlink" title="as 运算符"></a>as 运算符</h3><p>as 运算符和强制转换类似，只是他不会抛出异常。如果转换失败，会返回 null。</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span> : <span class="hljs-title">Person</span> &#123;&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name = <span class="hljs-string">&quot;1ess&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Age = <span class="hljs-number">20</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><br>    &#123;<br>        Employee emp = <span class="hljs-keyword">new</span> Employee();<br>        Person p = emp <span class="hljs-keyword">as</span> Person;<br>        <span class="hljs-keyword">if</span> (p != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//...</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/C%20Sharp(%E5%8D%81%E4%BA%8C)/" title="C Sharp(十二)"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: C Sharp(十二)</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/C%20Sharp(%E5%8D%81)/" title="C Sharp(十)">下一篇: C Sharp(十)&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2022&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>