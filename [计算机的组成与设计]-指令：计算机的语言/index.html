

<!DOCTYPE html>
<html lang="zh-tw" xmlns:v-bind="http://www.w3.org/1999/xhtml">

<head>
    <title>『计算机的组成与设计』-指令：计算机的语言 - A Sort Of A Blog</title>
<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="author" content="Stephen Chang">
<meta name="description" content="
当你的噩梦里再也没有恶龙和沼泽，而全都是生活难题的那一刻，你就知道你长大了。

计算机语言中的基本单词称为指令。一台计算机的全部指令称为该计算机的指令集...">
<meta name="keywords" content="">

<link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml">

    <meta charset="utf-8">
    <meta name="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="telephone=no" name="format-detection">
    <meta name="renderer" content="webkit">
    <meta name="theme-color" content="#ffffff">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous"> -->
<link rel="stylesheet" href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" crossorigin="anonymous">
<link rel="stylesheet" href="/css/journal.css?4926283">

<script src="/js/loadCSS.js"></script>
<script>
    loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Material+Icons");
    (function (d) {
        var config = {
                kitId: 'dwg1tuc',
                scriptTimeout: 3000,
                async: true
            },
            h = d.documentElement, t = setTimeout(function () {
                h.className = h.className.replace(/\bwf-loading\b/g, "") + " wf-inactive";
            }, config.scriptTimeout), tk = d.createElement("script"), f = false,
            s = d.getElementsByTagName("script")[0], a;
        h.className += " wf-loading";
        tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
        tk.async = true;
        tk.onload = tk.onreadystatechange = function () {
            a = this.readyState;
            if (f || a && a != "complete" && a != "loaded") return;
            f = true;
            clearTimeout(t);
            try {
                Typekit.load(config)
            } catch (e) {
            }
        };
        s.parentNode.insertBefore(tk, s)
    })(document);
</script>
<noscript>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Lora|Montserrat|Anonymous+Pro:400|Material+Icons"/>
</noscript>
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
<div id="top"></div>
<div id="app">
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            <a class="a-block drawer-menu-item false" href="https://1ess.github.io">
                Home
            </a>
            
            <a class="a-block drawer-menu-item false" href="/archives">
                Archive
            </a>
            

            
            

            
            <a class="a-block drawer-menu-item" href="/atom.xml">
                RSS
            </a>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="/">
            A Sort Of A Blog
        </a>
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="/">
        <div class="single-column-header-title">A Sort Of A Blog</div>
        <div class="single-column-header-subtitle">旧游无处不堪寻，无寻处，惟有少年心</div>
    </a>
</div>
<div ref="sideContainer" class="side-container">
    <a class="a-block nav-head false" href="/">
        <div class="nav-title">
            A Sort Of A Blog
        </div>
        <div class="nav-subtitle">
            旧游无处不堪寻，无寻处，惟有少年心
        </div>
    </a>

    <div class="nav-link-list">
        
        <a class="a-block no-tint nav-link-item false" href="/archives">
            Archive
        </a>
        

        
        

        
        <a class="a-block no-tint nav-link-item" href="/atom.xml">
            RSS
        </a>
        
    </div>

    
    <div class="nav-footer">
        &copy; 2022 <a href="https://1ess.github.io">A Sort Of A Blog</a>
    </div>
</div>
<div ref="extraContainer" class="extra-container">
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>

        
    </div>
</div>



<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            <div class="post-head-wrapper-text-only">
                <div class="post-title">
                    『计算机的组成与设计』-指令：计算机的语言
                    <div class="post-meta">
                        <time datetime="2018-05-09T00:00:00.000Z" itemprop="datePublished">
                            2018-05-09
                        </time>&nbsp;
                        
    
                        
                    </div>
                </div>
            </div>
    
            <div class="post-body-wrapper">
                <div class="post-body">
                    <blockquote>
<p>当你的噩梦里再也没有恶龙和沼泽，而全都是生活难题的那一刻，你就知道你长大了。</p>
</blockquote>
<p>计算机语言中的基本单词称为<strong>指令</strong>。一台计算机的全部指令称为该计算机的<strong>指令集</strong>。<br>尽管机器语言种类繁多，但他们之间十分相似，其差异性更像人类语言的”方言”。<br>本篇讲解 <strong>MIPS</strong> 指令集。   </p>
<ol>
<li><strong>Intel x86</strong>，在 PC 以及后 PC 时代的云计算领域占统治地位</li>
<li><strong>ARMv8</strong> 将 ARMv7 的地址范围从 32 位扩展到 64 位。讽刺的是，ARMv8 更接近 MIPS 而非 ARMv7</li>
</ol>
<p><strong>注意: MIPS 和 RAM 属于精简指令集(Reduced Instruction Set Computer，RISC)，而 x86 属于复杂指令集(Complex Instruction Set Computer，CISC)。</strong><br><strong>现在在 RISC 占统治地位的是 RAM，在 CISC 占统治地位的是 x86。MIPS 已死，MIPS 永生。</strong><br>以 MIPS 为代表的精简指令集关注的是: </p>
<ul>
<li>减少指令的类型</li>
<li>降低指令复杂度  </li>
</ul>
<p><strong>基本原则: a simple CPU is a faster CPU。</strong></p>
<h2 id="MIPS-操作数"><a href="#MIPS-操作数" class="headerlink" title="MIPS 操作数"></a>MIPS 操作数</h2><hr>
<table>
<thead>
<tr>
<th>名字</th>
<th>示例</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>32 个寄存器</td>
<td>$s0-$s7,$t0-$t9,$zero,$a0-$a3,<br>$v0-$v1,$k0-$k1,$gp,$fp,$sp,<br>$ra,$at</td>
<td>寄存器用于数据的快速存取，在 MIPS 中，只能对放在寄存器中的数据执行算术操作，寄存器 $zero 恒为 0，$at 被汇编器保留，处理大常数。</td>
</tr>
<tr>
<td>2<sup>32</sup> 个存储器字</td>
<td>Memory[0],Memory[4],…,<br>Memory[4294967292]</td>
<td>存储器只能通过数据传输指令访问。MIPS 使用字节编址，所以连续字地址相差 4</td>
</tr>
</tbody></table>
<h3 id="MIPS-寄存器字解释"><a href="#MIPS-寄存器字解释" class="headerlink" title="MIPS 寄存器字解释"></a>MIPS 寄存器字解释</h3><table>
<thead>
<tr>
<th>编号</th>
<th>名称</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>$zero</td>
<td>The Constant Value 0</td>
</tr>
<tr>
<td>1</td>
<td>$at</td>
<td>Assembler Temporary</td>
</tr>
<tr>
<td>2-3</td>
<td>$v0-$v1</td>
<td>Values of Function Results and Expression Evaluation</td>
</tr>
<tr>
<td>4-7</td>
<td>$a0-$a3</td>
<td>Arguments</td>
</tr>
<tr>
<td>8-15</td>
<td>$t0-$t7</td>
<td>Temporaries</td>
</tr>
<tr>
<td>16-23</td>
<td>$s0-$s7</td>
<td>Saved Temporaries</td>
</tr>
<tr>
<td>24-25</td>
<td>$t8-$t9</td>
<td>Temporaries</td>
</tr>
<tr>
<td>26-27</td>
<td>$k0-$k1</td>
<td>Reserved of OS Kernel</td>
</tr>
<tr>
<td>28</td>
<td>$gp</td>
<td>Global Pointer</td>
</tr>
<tr>
<td>29</td>
<td>$sp</td>
<td>Stack Pointer</td>
</tr>
<tr>
<td>30</td>
<td>$fp</td>
<td>Frame Pointer</td>
</tr>
<tr>
<td>31</td>
<td>$ra</td>
<td>Return Address</td>
</tr>
</tbody></table>
<h2 id="MIPS-指令"><a href="#MIPS-指令" class="headerlink" title="MIPS 指令"></a>MIPS 指令</h2><hr>
<h3 id="算术指令"><a href="#算术指令" class="headerlink" title="算术指令"></a>算术指令</h3><table>
<thead>
<tr>
<th>指令</th>
<th>示例</th>
<th>含义</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>加法</td>
<td>add $s1, $s2, $s3</td>
<td>$s1 = $s2 + $s3</td>
<td>三个寄存器操作数</td>
</tr>
<tr>
<td>减法</td>
<td>sub $s1, $s2, $s3</td>
<td>$s1 = $s2 - $s3</td>
<td>三个寄存器操作数</td>
</tr>
<tr>
<td>立即数加法</td>
<td>addi $s1, $s2, 20</td>
<td>$s1 = $s2 + 20</td>
<td>用于加常数数据</td>
</tr>
</tbody></table>
<h3 id="数据传输指令"><a href="#数据传输指令" class="headerlink" title="数据传输指令"></a>数据传输指令</h3><table>
<thead>
<tr>
<th>指令</th>
<th>示例</th>
<th>含义</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>取字</td>
<td>lw $s1, 20($s2)</td>
<td>$s1 = Memory[$s2 + 20]</td>
<td>将一个字从内存中取到寄存器</td>
</tr>
<tr>
<td>存字</td>
<td>sw $s1, 20($s2)</td>
<td>Memory[$s2 + 20] = $s1</td>
<td>将一个字从寄存器中存到内存</td>
</tr>
<tr>
<td>取半字</td>
<td>lh $s1, 20($s2)</td>
<td>$s1 = Memory[$s2 + 20]</td>
<td>将半个字从内存中取到寄存器</td>
</tr>
<tr>
<td>存半字</td>
<td>sw $s1, 20($s2)</td>
<td>Memory[$s2 + 20] = $s1</td>
<td>将半个字从寄存器中存到内存</td>
</tr>
<tr>
<td>取无符号半字</td>
<td>lhu $s1, 20($s2)</td>
<td>$s1 = Memory[$s2 + 20]</td>
<td>将半个字从内存中取到寄存器</td>
</tr>
<tr>
<td>取字节</td>
<td>lb $s1, 20($s2)</td>
<td>$s1 = Memory[$s2 + 20]</td>
<td>将一个字节从内存中取到寄存器</td>
</tr>
<tr>
<td>存字节</td>
<td>sb $s1, 20($s2)</td>
<td>Memory[$s2 + 20] = $s1</td>
<td>将一个字节从寄存器中存到内存</td>
</tr>
<tr>
<td>取无符号字节</td>
<td>lbu $s1, 20($s2)</td>
<td>$s1 = Memory[$s2 + 20]</td>
<td>将一个字节从内存中取到寄存器</td>
</tr>
<tr>
<td>取链接字</td>
<td>ll $s1, 20($s2)</td>
<td>$s1 = Memory[$s2 + 20]</td>
<td>取字作为原子交换的前半部分</td>
</tr>
<tr>
<td>存条件字</td>
<td>sc $s1, 20($s2)</td>
<td>Memory[$s2 + 20] = $s1; <br>$s1 = 0 or 1</td>
<td>存字作为原子交换的后半部分</td>
</tr>
<tr>
<td>取立即数高位</td>
<td>lui $s1, 20</td>
<td>$s1 = 20 * 2<sup>16</td>
<td>取立即数并放在高16位</td>
</tr>
</tbody></table>
<h3 id="位操作"><a href="#位操作" class="headerlink" title="位操作"></a>位操作</h3><table>
<thead>
<tr>
<th>指令</th>
<th>示例</th>
<th>含义</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>与</td>
<td>and $s1,$s2,$s3</td>
<td>$s1 = $s2 &amp; $s3</td>
<td>三个寄存器操作数按位与</td>
</tr>
<tr>
<td>或</td>
<td>or $s1,$s2,$s3</td>
<td>$s1 = $s2 &#124; $s3</td>
<td>三个寄存器操作数按位或</td>
</tr>
<tr>
<td>或非</td>
<td>nor $s1,$s2,$s3</td>
<td>$s1 = ~($s2 &#124; $s3)</td>
<td>三个寄存器操作数按位或非</td>
</tr>
<tr>
<td>立即数与</td>
<td>andi $s1,$s2,20</td>
<td>$s1 = $s2 &amp; 20</td>
<td>和常数按位与</td>
</tr>
<tr>
<td>立即数或</td>
<td>ori $s1,$s2,20</td>
<td>$s1 = $s2 &#124; 20</td>
<td>和常数按位或</td>
</tr>
<tr>
<td>逻辑左移</td>
<td>sll $s1,$s2,10</td>
<td>$s1 = $s2 &lt;&lt; 10</td>
<td>根据常数左移相应位</td>
</tr>
<tr>
<td>逻辑右移</td>
<td>srl $s1,$s2,10</td>
<td>$s1 = $s2 &gt;&gt; 10</td>
<td>根据常数右移相应位</td>
</tr>
</tbody></table>
<h3 id="条件分支"><a href="#条件分支" class="headerlink" title="条件分支"></a>条件分支</h3><table>
<thead>
<tr>
<th>指令</th>
<th>示例</th>
<th>含义</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>相等时跳转</td>
<td>beq $s1,$s2,25</td>
<td>if($s1 == $s2) go to PC + 4 + 100</td>
<td>相等检测，和 PC 相关的跳转</td>
</tr>
<tr>
<td>不相等时跳转</td>
<td>bne $s1,$s2,25</td>
<td>if($s1 != $s2) go to PC + 4 + 100</td>
<td>不相等检测，和 PC 相关的跳转</td>
</tr>
<tr>
<td>小于时置位</td>
<td>slt $s1,$s2,$s3</td>
<td>if($s2 &lt; $s3) $s1 = 1; else $s1 = 0</td>
<td>比较是否小于</td>
</tr>
<tr>
<td>无符号数比较小于时置位</td>
<td>sltu $s1,$s2,$s3</td>
<td>if($s2 &lt; $s3) $s1 = 1; else $s1 = 0</td>
<td>比较是否小于无符号数</td>
</tr>
<tr>
<td>无符号数比较小于立即数时置位</td>
<td>slti $s1,$s2,20</td>
<td>if($s2 &lt; 20) $s1 = 1; else $s1 = 0</td>
<td>比较是否小于常数</td>
</tr>
<tr>
<td>无符号数比较小于无符号立即数时置位</td>
<td>sltiu $s1,$s2,20</td>
<td>if($s2 &lt; 20) $s1 = 1; else $s1 = 0</td>
<td>比较是否小于无符号常数</td>
</tr>
</tbody></table>
<h3 id="无条件跳转"><a href="#无条件跳转" class="headerlink" title="无条件跳转"></a>无条件跳转</h3><table>
<thead>
<tr>
<th>指令</th>
<th>示例</th>
<th>含义</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>跳转</td>
<td>j 2500</td>
<td>goto 10000</td>
<td>跳转到目标地址</td>
</tr>
<tr>
<td>跳转至寄存器所指地址</td>
<td>jr $ra</td>
<td>go to $ra</td>
<td>用于 switch 语句以及过程调用</td>
</tr>
<tr>
<td>跳转并链接</td>
<td>jal 2500</td>
<td>$ra = PC + 4; go to 10000</td>
<td>用于过程调用</td>
</tr>
</tbody></table>
<h2 id="MIPS-指令的特点"><a href="#MIPS-指令的特点" class="headerlink" title="MIPS 指令的特点"></a>MIPS 指令的特点</h2><hr>
<ol>
<li>固定的指令长度(32-bit 即1 word)<br>简化了从存储器取指令。</li>
<li>简单的寻址模式<br>简化了从存储器取操作数。  </li>
<li>指令数量少，功能简单<br>简化指令的执行过程。  </li>
<li>只有 load 和 store 指令能访问存储器  </li>
</ol>
<h2 id="硬件设计三原则"><a href="#硬件设计三原则" class="headerlink" title="硬件设计三原则:"></a>硬件设计三原则:</h2><hr>
<p>任何计算机必须能执行算术运算。 MIPS 汇编语言使用 add a, b, c 表示将 b 和 c 相加的结果赋值给 a。<br>与加法类似的指令一般都有三个操作数: 两个进行运算的数和一个保存结果的数。<br>这种情况说明了硬件设计的三条基本原则的第一条:<br><strong>设计原则1: 简单源于规整</strong>。<br>MIPS 算术运算指令的操作数有严格限制。他们必须来自<strong>寄存器</strong>。MIPS 体系结构中寄存器的大小为 32 个，因此在 MIPS 体系结构中将其称为<strong>字 word</strong>。<br>高级语言中的变量与寄存器的一个主要区别就是寄存器的数量有限。<br>寄存器个数限制为 32 个的理由可表示为硬件设计的三条基本原则的第二条:    </p>
<p><strong>设计原则2: 越小越快</strong>。<br>大量的寄存器可能会使时钟周期变长，因为电信号传输更远的距离必然花费更多时间。 </p>
<p><strong>设计原则3:  优秀的设计需要折中的方案</strong><br>MIPS 设计者为保持所有指令长度相同，采用了一种折中方案: 不同类型的指令采用不同的指令格式。  </p>
<p>在高级语言中，有保存仅含一个数据的简单变量。也有像数组或结构那样的复杂数据结构。处理器只将少量数据保存在寄存器中，数据结构是存放在存储器中的。<br>并且之前说过，MIPS 的算术运算只能对寄存器进行操作，因此，MIPS 必须包含在存储器和寄存器之间传送数据的指令。这些指令称为<strong>数据传送指令</strong>。<br>为了访问存储器中的一个字，指令必须给出存储器地址(address)。<br><strong>将数据从储存器复制到寄存器的数据传输指令称为取数(load)指令</strong>。取数指令的格式是操作码之后接着目标寄存器，在后面是用来访问存储器的常数和寄存器。常数和第二个寄存器中的值相加即得到存储器地址。取数指令助记符为 lw(load word)。<br>数据传输指令的常数称为偏移量(offset)，存放基址的寄存器称为基址寄存器(base register)。<br><strong>与取数对应的指令称为存数 store word</strong>。<br>有一个常数操作数的快速加法指令称为加立即数(add immediate，addi)。MIPS 支持负常数，因此不需要设置减立即数指令。  </p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例:"></a>示例:</h4><p>假设</p>
<ul>
<li>A 是一个 100 个字的数组，首地址在寄存器 $19 中</li>
<li>变量 h 对应寄存器 $18</li>
<li>临时数据存储在寄存器 $8</li>
</ul>
<p>那么<br>A[10] = h + A[3]对应的 MIPS 指令是: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">lw $8, 12($19)<br>add $8, $18, $8<br>sw $8, 40($19)<br></code></pre></td></tr></table></figure>

<h2 id="MIPS-指令的基本格式"><a href="#MIPS-指令的基本格式" class="headerlink" title="MIPS 指令的基本格式"></a>MIPS 指令的基本格式</h2><hr>
<p>指令的布局形式叫做<strong>指令格式</strong>。  </p>
<p><img src="https://cdn.0xfee1dead.cn/contentImg/instruction-type/register-farmat-type.png"></p>
<p>注意:</p>
<ul>
<li>在 R 型指令中，rd 表示用于存放结果的目的操作数，rs 表示第一个源操作数，rt 表示第二个源操作数</li>
<li>在 I 型指令中，rt 表示接收取数结果的目的操作数，rs 表示源操作数</li>
</ul>
<h4 id="R-型指令示例"><a href="#R-型指令示例" class="headerlink" title="R 型指令示例"></a>R 型指令示例</h4><p>如: lw rd, rs, rt  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">add $8, $9, $10<br></code></pre></td></tr></table></figure>
<p>查指令编码表可得:<br><strong>opcode: 0, funct 32, shamt: 0(非移位指令)</strong><br>根据操作数可得:<br><strong>rd = 8(目的操作数), rs = 9(第一个源操作数), rt = 10(第二个源操作数)</strong><br>所以 R 指令为:<br><strong>000000 01001 01010 01000 00000 100000</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sll $t2, $s0, 4<br></code></pre></td></tr></table></figure>
<p>查指令编码表可得:<br><strong>opcode: 0, funct 0, shamt(shift amount): 4</strong><br>根据操作数可得:<br><strong>rd = 10(目的操作数), rs = 0(第一个源操作数), rt = 16(第二个源操作数)</strong><br>所以 R 指令为:<br><strong>000000 00000 10000 01010 00100 000000</strong></p>
<h4 id="I-型指令示例"><a href="#I-型指令示例" class="headerlink" title="I 型指令示例"></a>I 型指令示例</h4><p>如: addi rt, imm(rs)  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">addi $21, $22, -50<br></code></pre></td></tr></table></figure>
<p>查指令编码表可得:<br><strong>opcode: 8</strong><br>分析指令可得:<br><strong>rs = 22, rt = 21, imm = -50</strong><br>所以 I 指令为:<br><strong>001000 10110 10101 1111111111001110</strong></p>
<h2 id="决策指令"><a href="#决策指令" class="headerlink" title="决策指令"></a>决策指令</h2><hr>
<p>程序语言通常使用if语句描述决策，有时也使用 go to 语句和标签。<br>MIPS 汇编语言中有两条类似 if 和 go to 语句功能的指令: </p>
<ol>
<li>beq reg1, reg2, L1<br>该指令表示: 如果 reg1 与 reg2 中的数值相等，则跳转标签为 L1 的语句执行。  </li>
</ol>
<p><strong>beq(branch if equal)表示如果相等则分支</strong>。<br>2. bne reg1, reg2, L1<br>该指令表示: 如果 reg1 与 reg2 中的数值不相等，则跳转标签为 L1 的语句执行。<br><strong>bne(branch if not equal)表示如果不相等则分支</strong>。</p>
<p>这两条指令称为<strong>条件分支指令 conditional branch</strong>。指该指令先比较两个值，根据比较的结果决定是否从程序中的一个新地址开始执行指令序列。</p>
<p>还有另一种分支指令，称为<strong>无条件分支指令 unconditional branch</strong>。当遇到这种指令，程序必须分支。MIPS 将该指令命名为 <strong>j</strong> 意为 jump。</p>
<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><p>无论是 if 语句，还是循环语句，决策起着重要作用，这两种情况，决策的汇编指令是相同的。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">while (save[i] == k)<br>i += 1;<br></code></pre></td></tr></table></figure>
<p>假设 i 和 k 保存在$s3和$s5中，save 数组基址为$s6，将上述代码转为 MIPS 汇编。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Loop: sll $t0, $s3, 2<br>add $t0, $t0, $s6<br>bne $t0, $s5 Exit<br>add $s3, $s3, 1<br>j Loop<br>Exit:<br> <br></code></pre></td></tr></table></figure>

<h3 id="case-switch-语句"><a href="#case-switch-语句" class="headerlink" title="case/switch 语句"></a>case/switch 语句</h3><p>大多数程序设计语言都有 case/switch 语句，使得程序员可以根据某个变量的值选择不同的分支。<br>实现方式是: <strong>将多个指令序列分支的地址编码为一张表，即转移表(jump table)</strong><br>MIPS 提供了寄存器跳转指令 <strong>jr</strong> 意为 jump register，用来无条件跳转到寄存器的指定的地址。</p>
<h2 id="计算机硬件对过程的支持"><a href="#计算机硬件对过程的支持" class="headerlink" title="计算机硬件对过程的支持"></a>计算机硬件对过程的支持</h2><hr>
<p>过程(procedure)或函数是程序员进行结构化编程的工具，两者有助于提高程序的可理解性和代码的可重用性。<br>MIPS 在为过程调用分配寄存器时遵循下述约定:</p>
<ul>
<li>$a0-$a3: 用于传递参数的 4 个参数寄存器</li>
<li>$v0-$v1: 用于返回值的两个值寄存器</li>
<li>$ra: 用于返回起始点的返回地址寄存器</li>
</ul>
<p>除了分配这些寄存器之外，MIPS 还包括一条过程调用指令: 跳转到某个地址的同时将下一条指令的地址保存在 $ra 中，这条跳转和链接指令(jump and link instruction)格式为:<br><strong>jal procedureAddress</strong><br>在存储程序概念中，使用一个寄存器保存当前运行的指令地址是决定必要的。这个寄存器称为程序计数器(program counter)，在 MIPS 中简称 PC。jal 指令实际将 PC+4 保存在 $ra 中。</p>
<h3 id="使用更多的寄存器"><a href="#使用更多的寄存器" class="headerlink" title="使用更多的寄存器"></a>使用更多的寄存器</h3><p>换出寄存器最理想的数据结构是栈(stack): 一种后进先出的队列。<br>栈需要一个指针指向栈中最新分配的地址，以指示下一个过程置换出寄存器的位置。或是寄存器旧值的存放位置。在每次寄存器进行保存或恢复时，栈指针(stack pointer)以字为单位进行调整。<br>MIPS 为栈指针准备了第 29 号寄存器 $sp。<br>将数据放入栈中的操作称为 push。<br>从栈中移除数据的操作称为 pop。</p>

                </div>
            </div>
    
            <nav class="post-pagination">
    
    <a class="newer-posts" href="/%5B%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%BB%84%E6%88%90%E4%B8%8E%E8%AE%BE%E8%AE%A1%5D-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97/">
        Previous post<br>『计算机的组成与设计』-计算机的算数运算
    </a>
    
    <span class="page-number"></span>
    
    <a class="older-posts" href="/%5B%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%BB%84%E6%88%90%E4%B8%8E%E8%AE%BE%E8%AE%A1%5D-%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%A6%82%E8%A6%81%E4%B8%8E%E6%8A%80%E6%9C%AF/">
        Next post<br>『计算机的组成与设计』-计算机概要与技术
    </a>
    
</nav>

    
            


        </div>
    </div>
    <div class="single-column-footer">
    &copy; 2022 <a href="https://1ess.github.io">A Sort Of A Blog</a>
</div>
</div>

</div>
<script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.3.1/jquery.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/popper.js/1.14.4/esm/popper.min.js"
        integrity="sha256-EGs9T1xMHdvM1geM8jPpoo8EZ1V1VRsmcJz8OByENLA=" crossorigin="anonymous"></script>
<script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap/4.5.3/js/bootstrap.min.js"
        integrity="sha512-8qmis31OQi6hIRgvkht0s6mCOittjMa9GMqtK9hes5iEQBQE/Ca6yGE5FsW36vyipGoWQswBj/QBm2JR086Rkw==" crossorigin="anonymous"></script>
<script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/vue/2.5.17/vue.min.js"
        integrity="sha256-FtWfRI+thWlNz2sB3SJbwKx5PgMyKIVgwHCTwa3biXc=" crossorigin="anonymous"></script>
<script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/smooth-scroll/14.2.1/smooth-scroll.polyfills.min.js"
        integrity="sha256-CI4Gq5E0io1Pv0xM3qPM+NUIOhbIBvC3GiN1Y4KhXpw=" crossorigin="anonymous"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"
        integrity="sha256-EGs9T1xMHdvM1geM8jPpoo8EZ1V1VRsmcJz8OByENLA=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
        integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.min.js"
        integrity="sha256-FtWfRI+thWlNz2sB3SJbwKx5PgMyKIVgwHCTwa3biXc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/smooth-scroll@14.2.1/dist/smooth-scroll.polyfills.min.js"
        integrity="sha256-CI4Gq5E0io1Pv0xM3qPM+NUIOhbIBvC3GiN1Y4KhXpw=" crossorigin="anonymous"></script> -->
<script src="/js/journal.js?41646550"></script>



</body>
</html>
