<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title> · A Sort Of A Blog</title><meta name="description" content="本篇开始，将会学习有关 Python 爬虫的相关知识，通过几篇的介绍，完整学习 Python 爬虫的方方面面。
在学习 Python 爬虫之前，我们首先需要下载安装 MongoDB，Redis 以及 MySQL。在学习爬虫的过程中都会使用到，之后的学习中默认已经完成相关软件的安装。
MongoDB "><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="https://cdn.jsdelivr.net/gh/1ess/cdn/h4cker/favicon-32x32.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">0x7c00</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">张冬冬的博客</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首頁</a></li><li><a href="/archives">歸檔</a></li><li class="soc"><a href="https://github.com/1ess" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2021&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a></a></p><p class="post-meta"><span class="date meta-item">發佈於&nbsp;2021-07-14</span></p><p class="post-abstract"><p>本篇开始，将会学习有关 Python 爬虫的相关知识，通过几篇的介绍，完整学习 Python 爬虫的方方面面。</p>
<p>在学习 Python 爬虫之前，我们首先需要下载安装 MongoDB，Redis 以及 MySQL。在学习爬虫的过程中都会使用到，之后的学习中默认已经完成相关软件的安装。</p>
<h2 id="MongoDB-Redis-MySQL-相关问题"><a href="#MongoDB-Redis-MySQL-相关问题" class="headerlink" title="MongoDB Redis MySQL 相关问题"></a>MongoDB Redis MySQL 相关问题</h2><hr>
<p>本人使用 Mac 开发，所以说一下 Mac 下相关软件的注意事项。</p>
<h3 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><pre class="line-numbers language-shell"><code class="language-shell">brew install mongodb
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>使用 mongo 命令进入交互模式: </p>
<pre class="line-numbers language-shell"><code class="language-shell">mongo
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="exception-in-initAndListen-NonExistentPath-Data-directory-data-db-not-found-terminating"><a href="#exception-in-initAndListen-NonExistentPath-Data-directory-data-db-not-found-terminating" class="headerlink" title="exception in initAndListen: NonExistentPath: Data directory /data/db not found., terminating"></a>exception in initAndListen: NonExistentPath: Data directory /data/db not found., terminating</h4><p>因为未创建 /data/db 文件夹。我们可以使用: </p>
<pre class="line-numbers language-shell"><code class="language-shell">mongod --dbpath ~/db
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>转换链接的路径。</p>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><pre class="line-numbers language-shell"><code class="language-shell">brew install redis
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们通常会修改 /usr/local/etc/redis.conf 文件，注释 bind 127.0.0.1，解注释 requirepass，设置一个安全密码。<br>再使用: </p>
<pre class="line-numbers language-shell"><code class="language-shell">brew service restart redis 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>重启 redis 服务。</p>
<h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><p>我们可以使用: </p>
<pre class="line-numbers language-shell"><code class="language-shell">redis-cli 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>启动命令行程序。</p>
<p>在 redis 交互模式下再使用: </p>
<pre class="line-numbers language-shell"><code class="language-shell">auth &#123;password&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>授权即可使用。</p>
<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><h4 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h4><pre class="line-numbers language-shell"><code class="language-shell">brew install mysql
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h4><p>启动: </p>
<pre class="line-numbers language-shell"><code class="language-shell">brew services start mysql
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>进入交互模式: </p>
<pre class="line-numbers language-python"><code class="language-python">mysql <span class="token operator">-</span>uroot
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="Python-多版本共存问题"><a href="#Python-多版本共存问题" class="headerlink" title="Python 多版本共存问题"></a>Python 多版本共存问题</h2><hr>
<p>如果都配置到环境变量中，可以将其可执行文件取不同名来区别不同的 Python 和 pip。</p>
<h2 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h2><hr>
<p>爬虫就是<strong>请求</strong>网站并<strong>提取</strong>数据的<strong>自动化</strong>程序。</p>
<h2 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h2><hr>
<p>urllib 是 Python 内置的 HTTP 请求库: </p>
<ul>
<li>urllib.request    请求模块</li>
<li>urllib.error      异常处理模块</li>
<li>urllib.parse      url 解析模块</li>
<li>urllib.robotparse robot.txt 解析模块</li>
</ul>
<h3 id="urllib-request-模块"><a href="#urllib-request-模块" class="headerlink" title="urllib.request 模块"></a>urllib.request 模块</h3><h4 id="urlopen-方法"><a href="#urlopen-方法" class="headerlink" title="urlopen 方法"></a>urlopen 方法</h4><p>urllib.request 最重要的方法就是 urlopen 方法: </p>
<pre class="line-numbers language-python"><code class="language-python">urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>None<span class="token punctuation">,</span> <span class="token punctuation">[</span>timeout<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">,</span> 
                        cafile<span class="token operator">=</span>None<span class="token punctuation">,</span> capath<span class="token operator">=</span>None<span class="token punctuation">,</span> 
                        cadefault<span class="token operator">=</span>None<span class="token punctuation">,</span> context<span class="token operator">=</span>None<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment" spellcheck="true"># get 请求</span>
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
<span class="token comment" spellcheck="true"># post 请求 参数格式为 application/x-www-form-urlencoded</span>
data <span class="token operator">=</span> bytes<span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'foo': 'bar'&amp;#125;), encoding='utf8')</span>
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/post'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># &amp;#123;</span>
<span class="token comment" spellcheck="true">#   "args": &amp;#123;&amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "data": "", </span>
<span class="token comment" spellcheck="true">#   "files": &amp;#123;&amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "form": &amp;#123;</span>
<span class="token comment" spellcheck="true">#     "foo": "bar"</span>
<span class="token comment" spellcheck="true">#   &amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "headers": &amp;#123;</span>
<span class="token comment" spellcheck="true">#     "Accept-Encoding": "identity", </span>
<span class="token comment" spellcheck="true">#     "Content-Length": "7", </span>
<span class="token comment" spellcheck="true">#     "Content-Type": "application/x-www-form-urlencoded", </span>
<span class="token comment" spellcheck="true">#     "Host": "httpbin.org", </span>
<span class="token comment" spellcheck="true">#     "User-Agent": "Python-urllib/3.7"</span>
<span class="token comment" spellcheck="true">#   &amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "json": null, </span>
<span class="token comment" spellcheck="true">#   "origin": "42.100.1.169, 42.100.1.169", </span>
<span class="token comment" spellcheck="true">#   "url": "https://httpbin.org/post"</span>
<span class="token comment" spellcheck="true"># &amp;#125;</span>


<span class="token keyword">import</span> json
<span class="token comment" spellcheck="true"># post 请求 参数格式为 application/json</span>
data <span class="token operator">=</span> bytes<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'foo': 'bar'&amp;#125;), encoding='utf8')</span>
headers <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>
req <span class="token operator">=</span> request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://httpbin.org/post'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># &amp;#123;</span>
<span class="token comment" spellcheck="true">#   "args": &amp;#123;&amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "data": "&amp;#123;\"foo\": \"bar\"&amp;#125;", </span>
<span class="token comment" spellcheck="true">#   "files": &amp;#123;&amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "form": &amp;#123;&amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "headers": &amp;#123;</span>
<span class="token comment" spellcheck="true">#     "Accept-Encoding": "identity", </span>
<span class="token comment" spellcheck="true">#     "Content-Length": "14", </span>
<span class="token comment" spellcheck="true">#     "Content-Type": "application/json", </span>
<span class="token comment" spellcheck="true">#     "Host": "httpbin.org", </span>
<span class="token comment" spellcheck="true">#     "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36"</span>
<span class="token comment" spellcheck="true">#   &amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "json": &amp;#123;</span>
<span class="token comment" spellcheck="true">#     "foo": "bar"</span>
<span class="token comment" spellcheck="true">#   &amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "origin": "42.100.1.169, 42.100.1.169", </span>
<span class="token comment" spellcheck="true">#   "url": "https://httpbin.org/post"</span>
<span class="token comment" spellcheck="true"># &amp;#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>error
<span class="token comment" spellcheck="true"># 设置超时时间</span>
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/get'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 超时处理</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/get'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> urllib<span class="token punctuation">.</span>error<span class="token punctuation">.</span>URLError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'TIME OUT'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Request-方法"><a href="#Request-方法" class="headerlink" title="Request 方法"></a>Request 方法</h4><p>Request 方法用来处理 requestheader 等信息，构建的 request 对象可以直接传入 urlopen 方法: </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse
<span class="token comment" spellcheck="true"># 修改 header 信息</span>
headers <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36'&amp;#125;</span>
data <span class="token operator">=</span> bytes<span class="token punctuation">(</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'foo': 'bar'&amp;#125;), encoding='utf8')</span>
url <span class="token operator">=</span> <span class="token string">'http://httpbin.org/post'</span>

req <span class="token operator">=</span> request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

response <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="response-对象"><a href="#response-对象" class="headerlink" title="response 对象"></a>response 对象</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># &lt;class 'http.client.HTTPResponse'></span>

<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 200</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>getheaders<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># [('Bdpagetype', '1'), ('Bdqid', '0xf4c906b1000200f2'), ('Cache-Control', 'private'), ('Content-Type', 'text/html'), ('Cxy_all', 'baidu+6591fe8b9beee94e197eff1c03bdb4d3'), ('Date', 'Wed, 08 May 2019 02:29:01 GMT'), ('Expires', 'Wed, 08 May 2019 02:28:50 GMT'), ('P3p', 'CP=" OTI DSP COR IVA OUR IND COM "'), ('Server', 'BWS/1.1'), ('Set-Cookie', 'BAIDUID=2E7B4EB53DFE40735CF45D5D2287D0D5:FG=1; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com'), ('Set-Cookie', 'BIDUPSID=2E7B4EB53DFE40735CF45D5D2287D0D5; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com'), ('Set-Cookie', 'PSTM=1557282541; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com'), ('Set-Cookie', 'delPer=0; path=/; domain=.baidu.com'), ('Set-Cookie', 'BDSVRTM=0; path=/'), ('Set-Cookie', 'BD_HOME=0; path=/'), ('Set-Cookie', 'H_PS_PSSID=28883_1469_28940_28987_28803_21088_28774_28723_28963_28835_28584_28603_22160; path=/; domain=.baidu.com'), ('Vary', 'Accept-Encoding'), ('X-Ua-Compatible', 'IE=Edge,chrome=1'), ('Connection', 'close'), ('Transfer-Encoding', 'chunked')]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>getheader<span class="token punctuation">(</span><span class="token string">'Server'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># BWS/1.1</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ProxyHandler-方法"><a href="#ProxyHandler-方法" class="headerlink" title="ProxyHandler 方法"></a>ProxyHandler 方法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment" spellcheck="true"># 通过 ProxyHandler 来设置使用代理服务器</span>
<span class="token comment" spellcheck="true"># https://www.xicidaili.com/ 上找的免费代理</span>
<span class="token comment" spellcheck="true"># 单 IP 代理</span>
proxy_handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>ProxyHandler<span class="token punctuation">(</span>dict<span class="token punctuation">(</span>http<span class="token operator">=</span><span class="token string">'http://112.85.129.159:9999'</span><span class="token punctuation">,</span> https<span class="token operator">=</span><span class="token string">'https://162.105.89.142:1080'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>proxy_handler<span class="token punctuation">)</span>
response <span class="token operator">=</span> opener<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/get'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># &amp;#123;</span>
<span class="token comment" spellcheck="true">#   "args": &amp;#123;&amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "headers": &amp;#123;</span>
<span class="token comment" spellcheck="true">#     "Accept-Encoding": "identity", </span>
<span class="token comment" spellcheck="true">#     "Cache-Control": "max-age=259200", </span>
<span class="token comment" spellcheck="true">#     "Host": "httpbin.org", </span>
<span class="token comment" spellcheck="true">#     "User-Agent": "Python-urllib/3.7"</span>
<span class="token comment" spellcheck="true">#   &amp;#125;, </span>
<span class="token comment" spellcheck="true">#   "origin": "112.85.129.159, 112.85.129.159", </span>
<span class="token comment" spellcheck="true">#   "url": "https://httpbin.org/get"</span>
<span class="token comment" spellcheck="true"># &amp;#125;</span>

<span class="token comment" spellcheck="true"># 多 IP 代理</span>
proxy_list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"http" : "61.135.217.7:80"&amp;#125;,</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"http" : "111.155.116.245:8123"&amp;#125;,</span>
    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"http" : "122.114.31.177:808"&amp;#125;,</span>
<span class="token punctuation">]</span>
proxy <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>proxy_list<span class="token punctuation">)</span>
proxy_handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>ProxyHandler<span class="token punctuation">(</span>proxy<span class="token punctuation">)</span>

opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>proxy_handler<span class="token punctuation">)</span>
response <span class="token operator">=</span> opener<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/get'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="HTTPCookieProcessor-方法"><a href="#HTTPCookieProcessor-方法" class="headerlink" title="HTTPCookieProcessor 方法"></a>HTTPCookieProcessor 方法</h4><pre class="line-numbers language-python"><code class="language-python">cookieJar <span class="token operator">=</span> http<span class="token punctuation">.</span>cookiejar<span class="token punctuation">.</span>CookieJar<span class="token punctuation">(</span><span class="token punctuation">)</span>
cookie_handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookieJar<span class="token punctuation">)</span>
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>cookie_handler<span class="token punctuation">)</span>
response <span class="token operator">=</span> opener<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> cookie <span class="token keyword">in</span> cookieJar<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> cookie<span class="token punctuation">.</span>value<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># BAIDUID=B57C5748112C13EE801F3E0DBBC7DBB1:FG=1</span>
<span class="token comment" spellcheck="true"># BIDUPSID=B57C5748112C13EE801F3E0DBBC7DBB1</span>
<span class="token comment" spellcheck="true"># H_PS_PSSID=1443_28776_21100_28772_28723_28964_28830_28584_28603</span>
<span class="token comment" spellcheck="true"># PSTM=1557293120</span>
<span class="token comment" spellcheck="true"># delPer=0</span>
<span class="token comment" spellcheck="true"># BDSVRTM=0</span>
<span class="token comment" spellcheck="true"># BD_HOME=0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="urllib-error-模块"><a href="#urllib-error-模块" class="headerlink" title="urllib.error 模块"></a>urllib.error 模块</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span> error
<span class="token comment" spellcheck="true"># HTTPError 是 URLError 的子类</span>
<span class="token comment" spellcheck="true"># URLError 只有一个 reason 属性</span>
<span class="token comment" spellcheck="true"># HTTPError 还有 code 和  headers 熟悉</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'https://github.com/1ess/404'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> error<span class="token punctuation">.</span>HTTPError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">,</span> e<span class="token punctuation">.</span>code<span class="token punctuation">,</span> e<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> error<span class="token punctuation">.</span>URLError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'SUCCESS'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Not Found</span>
<span class="token comment" spellcheck="true"># 404</span>
<span class="token comment" spellcheck="true"># Content-Type: text/html</span>
<span class="token comment" spellcheck="true"># Server: Microsoft-IIS/8.5</span>
<span class="token comment" spellcheck="true"># X-Powered-By: ASP.NET</span>
<span class="token comment" spellcheck="true"># Date: Wed, 08 May 2019 06:10:44 GMT</span>
<span class="token comment" spellcheck="true"># Connection: close</span>
<span class="token comment" spellcheck="true"># Content-Length: 1163</span>

<span class="token comment" spellcheck="true"># &lt;class 'str'></span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'https://github.com/1ess/404'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> error<span class="token punctuation">.</span>HTTPError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">,</span> e<span class="token punctuation">.</span>code<span class="token punctuation">,</span> e<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> error<span class="token punctuation">.</span>URLError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'SUCCESS'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># timed out</span>
<span class="token comment" spellcheck="true"># &lt;class 'socket.timeout'></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="urllib-parse-模块"><a href="#urllib-parse-模块" class="headerlink" title="urllib.parse 模块"></a>urllib.parse 模块</h3><h4 id="urlparse-方法"><a href="#urlparse-方法" class="headerlink" title="urlparse 方法"></a>urlparse 方法</h4><pre class="line-numbers language-python"><code class="language-python">urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>urlstring<span class="token punctuation">,</span> scheme<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> allow_fragments<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse

result <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/index.html?user=1ess#comment'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># &lt;class 'urllib.parse.ParseResult'></span>
<span class="token comment" spellcheck="true"># ParseResult(scheme='http', netloc='www.baidu.com', path='/index.html', params='', query='user=1ess', fragment='comment')</span>

result <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span><span class="token string">'www.baidu.com/index.html?user=1ess#comment'</span><span class="token punctuation">,</span> scheme<span class="token operator">=</span><span class="token string">'https'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ParseResult(scheme='https', netloc='', path='www.baidu.com/index.html', params='', query='user=1ess', fragment='comment')</span>

result <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/index.html?user=1ess#comment'</span><span class="token punctuation">,</span> scheme<span class="token operator">=</span><span class="token string">'https'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ParseResult(scheme='http', netloc='', path='www.baidu.com/index.html', params='', query='user=1ess', fragment='comment')</span>

result <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/index.html?user=1ess#comment'</span><span class="token punctuation">,</span> allow_fragments<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ParseResult(scheme='http', netloc='www.baidu.com', path='/index.html', params='', query='user=1ess#comment', fragment='')</span>

result <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/index.html#comment'</span><span class="token punctuation">,</span> allow_fragments<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ParseResult(scheme='http', netloc='www.baidu.com', path='/index.html#comment', params='', query='', fragment='')</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="urlunparse-方法"><a href="#urlunparse-方法" class="headerlink" title="urlunparse 方法"></a>urlunparse 方法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse

data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http'</span><span class="token punctuation">,</span> <span class="token string">'www.baidu.com'</span><span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'id=1'</span><span class="token punctuation">,</span> <span class="token string">'comment'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>parse<span class="token punctuation">.</span>urlunparse<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># http://www.baidu.com/index.html;user?id=1#comment</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="urljoin-方法"><a href="#urljoin-方法" class="headerlink" title="urljoin 方法"></a>urljoin 方法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse

<span class="token keyword">print</span><span class="token punctuation">(</span>parse<span class="token punctuation">.</span>urljoin<span class="token punctuation">(</span><span class="token string">'https://github.com'</span><span class="token punctuation">,</span> <span class="token string">'/1ess'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># https://github.com/1ess</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="urlencode-方法"><a href="#urlencode-方法" class="headerlink" title="urlencode 方法"></a>urlencode 方法</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse

params <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'foo': 'bar'&amp;#125;</span>
base_url <span class="token operator">=</span> <span class="token string">'http://www.baidu.com?'</span>
url <span class="token operator">=</span> base_url <span class="token operator">+</span> parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># http://www.baidu.com?foo=bar</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</p></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/Python(%E5%8D%81%E4%B8%80)/" title=""><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: </a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/Docker%20%E5%9F%BA%E7%A1%80/" title="Docker 基础">下一篇: Docker 基础&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2021&nbsp;</p><p>如果五分钟后她必须进安检，如果安检在十米之外</p><p>那意味着，你们可以亲吻四分五十秒。&nbsp;</p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>